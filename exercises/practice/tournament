import
  std / unittest

import
  tournament

suite "tournament tests":
  test "just the header if no input":
    check tally(newSeq[int]()) ==
        @["Team                           | MP |  W |  D |  L |  P"]
  test "a win is three points, a loss is zero points":
    check tally(@["Allegoric Alaskans;Blithering Badgers;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  1 |  1 |  0 |  0 |  3",
          "Blithering Badgers             |  1 |  0 |  0 |  1 |  0"]
  test "a win can also be expressed as a loss":
    check tally(@["Blithering Badgers;Allegoric Alaskans;loss"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  1 |  1 |  0 |  0 |  3",
          "Blithering Badgers             |  1 |  0 |  0 |  1 |  0"]
  test "a different team can win":
    check tally(@["Blithering Badgers;Allegoric Alaskans;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Blithering Badgers             |  1 |  1 |  0 |  0 |  3",
          "Allegoric Alaskans             |  1 |  0 |  0 |  1 |  0"]
  test "a draw is one point each":
    check tally(@["Allegoric Alaskans;Blithering Badgers;draw"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  1 |  0 |  1 |  0 |  1",
          "Blithering Badgers             |  1 |  0 |  1 |  0 |  1"]
  test "There can be more than one match":
    check tally(@["Allegoric Alaskans;Blithering Badgers;win",
                  "Allegoric Alaskans;Blithering Badgers;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  2 |  2 |  0 |  0 |  6",
          "Blithering Badgers             |  2 |  0 |  0 |  2 |  0"]
  test "There can be more than one winner":
    check tally(@["Allegoric Alaskans;Blithering Badgers;loss",
                  "Allegoric Alaskans;Blithering Badgers;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  2 |  1 |  0 |  1 |  3",
          "Blithering Badgers             |  2 |  1 |  0 |  1 |  3"]
  test "There can be more than two teams":
    check tally(@["Allegoric Alaskans;Blithering Badgers;win",
                  "Blithering Badgers;Courageous Californians;win",
                  "Courageous Californians;Allegoric Alaskans;loss"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  2 |  2 |  0 |  0 |  6",
          "Blithering Badgers             |  2 |  1 |  0 |  1 |  3",
          "Courageous Californians        |  2 |  0 |  0 |  2 |  0"]
  test "typical input":
    check tally(@["Allegoric Alaskans;Blithering Badgers;win",
                  "Devastating Donkeys;Courageous Californians;draw",
                  "Devastating Donkeys;Allegoric Alaskans;win",
                  "Courageous Californians;Blithering Badgers;loss",
                  "Blithering Badgers;Devastating Donkeys;loss",
                  "Allegoric Alaskans;Courageous Californians;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Devastating Donkeys            |  3 |  2 |  1 |  0 |  7",
          "Allegoric Alaskans             |  3 |  2 |  0 |  1 |  6",
          "Blithering Badgers             |  3 |  1 |  0 |  2 |  3",
          "Courageous Californians        |  3 |  0 |  1 |  2 |  1"]
  test "incomplete competition (not all pairs have played)":
    check tally(@["Allegoric Alaskans;Blithering Badgers;loss",
                  "Devastating Donkeys;Allegoric Alaskans;loss",
                  "Courageous Californians;Blithering Badgers;draw",
                  "Allegoric Alaskans;Courageous Californians;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  3 |  2 |  0 |  1 |  6",
          "Blithering Badgers             |  2 |  1 |  1 |  0 |  4",
          "Courageous Californians        |  2 |  0 |  1 |  1 |  1",
          "Devastating Donkeys            |  1 |  0 |  0 |  1 |  0"]
  test "ties broken alphabetically":
    check tally(@["Courageous Californians;Devastating Donkeys;win",
                  "Allegoric Alaskans;Blithering Badgers;win",
                  "Devastating Donkeys;Allegoric Alaskans;loss",
                  "Courageous Californians;Blithering Badgers;win",
                  "Blithering Badgers;Devastating Donkeys;draw",
                  "Allegoric Alaskans;Courageous Californians;draw"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Allegoric Alaskans             |  3 |  2 |  1 |  0 |  7",
          "Courageous Californians        |  3 |  2 |  1 |  0 |  7",
          "Blithering Badgers             |  3 |  0 |  1 |  2 |  1",
          "Devastating Donkeys            |  3 |  0 |  1 |  2 |  1"]
  test "ensure points sorted numerically":
    check tally(@["Devastating Donkeys;Blithering Badgers;win",
                  "Devastating Donkeys;Blithering Badgers;win",
                  "Devastating Donkeys;Blithering Badgers;win",
                  "Devastating Donkeys;Blithering Badgers;win",
                  "Blithering Badgers;Devastating Donkeys;win"]) ==
        @["Team                           | MP |  W |  D |  L |  P",
          "Devastating Donkeys            |  5 |  4 |  0 |  1 | 12",
          "Blithering Badgers             |  5 |  1 |  0 |  4 |  3"]
